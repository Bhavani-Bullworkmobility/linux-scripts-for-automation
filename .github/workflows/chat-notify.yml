name: Notify Google Chat

on:
  push:
    branches:
      - "main"
      - "release"
      - "release/**"
      - "stage"
      - "staging"
      - "dev"
      - "development"
  pull_request:
    types: [opened, reopened, closed]

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: Determine Environment
        id: env
        run: |
          if [[ "${GITHUB_REF_NAME}" == "main" ]]; then
            echo "stage_name=Release" >> $GITHUB_OUTPUT
          elif [[ "${GITHUB_REF_NAME}" == "release" || "${GITHUB_REF_NAME}" == release/* ]]; then
            echo "stage_name=Release" >> $GITHUB_OUTPUT
          elif [[ "${GITHUB_REF_NAME}" == "stage" || "${GITHUB_REF_NAME}" == "staging" ]]; then
            echo "stage_name=Staging" >> $GITHUB_OUTPUT
          elif [[ "${GITHUB_REF_NAME}" == "dev" || "${GITHUB_REF_NAME}" == "development" ]]; then
            echo "stage_name=Development" >> $GITHUB_OUTPUT
          else
            echo "stage_name=Unknown" >> $GITHUB_OUTPUT
          fi

      - name: Send notification to Google Chat
        uses: google-github-actions/send-google-chat-webhook@v0.0.2
        with:
          webhook_url: ${{ secrets.GOOGLE_CHAT_WEBHOOK_URL }}
          message: |
            **Repository:** ${{ github.repository }}
            **Branch:** ${{ github.ref_name }}
            **Environment:** ${{ steps.env.outputs.stage_name }}
            **Triggered By:** ${{ github.actor }}
            **Workflow:** ${{ github.workflow }}
            **Commit:** ${{ github.sha }}

            ðŸ•’ **Time (UTC):** ${{ github.event.repository.updated_at }}

            ðŸ”— **View Workflow:** https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}
